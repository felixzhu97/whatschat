@startuml User_Story_Map

!theme plain

skinparam linetype ortho
skinparam packageStyle rectangle

title WhatsChat 用户故事地图 (User Story Map)

' ============================================
' 用户活动：认证与账号管理
' ============================================

package "认证与账号管理" #E3F2FD {
  class AuthEpic {
    + 史诗：用户认证与账号管理
    --
    作为用户
    我希望能够安全地注册和登录
    以便使用 WhatsChat 的所有功能
  }
  
  class AuthStories {
    + 用户故事
    --
    1. 用户注册
    2. 用户登录
    3. 密码重置
    4. 个人资料管理
    5. 头像上传
    6. 密码修改
  }
  
  class AuthCriteria {
    + 验收标准
    --
    - 注册表单验证
    - JWT 令牌管理
    - 密码加密存储
    - 资料更新实时生效
  }
}

AuthEpic --> AuthStories
AuthStories --> AuthCriteria

' ============================================
' 用户活动：联系人管理
' ============================================

package "联系人管理" #BBDEFB {
  class ContactEpic {
    + 史诗：联系人管理
    --
    作为用户
    我希望能够管理我的联系人
    以便快速找到并联系他们
  }
  
  class ContactStories {
    + 用户故事
    --
    1. 添加联系人
    2. 搜索联系人
    3. 查看联系人详情
    4. 删除联系人
    5. 联系人分组
    6. 黑名单管理
  }
  
  class ContactCriteria {
    + 验收标准
    --
    - 支持多种搜索方式
    - 实时联系人状态
    - 联系人信息完整
    - 操作反馈及时
  }
}

ContactEpic --> ContactStories
ContactStories --> ContactCriteria

' ============================================
' 用户活动：消息通信
' ============================================

package "消息通信" #90CAF9 {
  class MessageEpic {
    + 史诗：实时消息通信
    --
    作为用户
    我希望能够实时发送和接收消息
    以便与联系人保持沟通
  }
  
  class MessageStories {
    + 用户故事
    --
    1. 发送文本消息
    2. 发送多媒体消息（图片、视频、音频、文件）
    3. 接收消息通知
    4. 消息状态显示（已发送、已送达、已读）
    5. 消息搜索
    6. 消息删除和撤回
    7. 消息转发
    8. 消息标记（星标、未读）
    9. 语音消息录制
    10. 位置分享
  }
  
  class MessageCriteria {
    + 验收标准
    --
    - 消息实时同步
    - 支持多种消息类型
    - 消息状态准确
    - 搜索功能强大
    - 消息加密传输
  }
}

MessageEpic --> MessageStories
MessageStories --> MessageCriteria

' ============================================
' 用户活动：音视频通话
' ============================================

package "音视频通话" #64B5F6 {
  class CallEpic {
    + 史诗：音视频通话
    --
    作为用户
    我希望能够进行高质量的音视频通话
    以便进行实时沟通
  }
  
  class CallStories {
    + 用户故事
    --
    1. 发起语音通话
    2. 发起视频通话
    3. 接听/拒绝来电
    4. 通话中功能（静音、摄像头开关）
    5. 通话记录查看
    6. 未接来电提醒
    7. 群组通话
    8. 通话质量优化
  }
  
  class CallCriteria {
    + 验收标准
    --
    - WebRTC 稳定连接
    - 低延迟通话
    - 清晰音视频质量
    - 通话状态准确
    - 支持多设备
  }
}

CallEpic --> CallStories
CallStories --> CallCriteria

' ============================================
' 用户活动：群组功能
' ============================================

package "群组功能" #42A5F5 {
  class GroupEpic {
    + 史诗：群组聊天与管理
    --
    作为用户
    我希望能够创建和管理群组
    以便进行多人协作和沟通
  }
  
  class GroupStories {
    + 用户故事
    --
    1. 创建群组
    2. 邀请成员加入
    3. 移除群组成员
    4. 设置群组信息（名称、头像、描述）
    5. 群组消息发送
    6. @提及成员
    7. 群组权限管理
    8. 退出群组
    9. 解散群组
    10. 群组公告发布
  }
  
  class GroupCriteria {
    + 验收标准
    --
    - 支持大群组（100+成员）
    - 权限控制精确
    - 成员操作实时同步
    - 群组信息可搜索
  }
}

GroupEpic --> GroupStories
GroupStories --> GroupCriteria

' ============================================
' 用户活动：状态功能
' ============================================

package "状态功能" #1E88E5 {
  class StatusEpic {
    + 史诗：状态更新与查看
    --
    作为用户
    我希望能够发布和查看状态更新
    以便分享生活动态
  }
  
  class StatusStories {
    + 用户故事
    --
    1. 发布文字状态
    2. 发布图片/视频状态
    3. 查看联系人状态
    4. 状态隐私设置
    5. 状态过期管理（24小时）
    6. 状态互动（查看统计）
  }
  
  class StatusCriteria {
    + 验收标准
    --
    - 状态自动过期
    - 隐私控制灵活
    - 多媒体支持
    - 查看统计准确
  }
}

StatusEpic --> StatusStories
StatusStories --> StatusCriteria

' ============================================
' 用户活动：设置与隐私
' ============================================

package "设置与隐私" #0D47A1 {
  class SettingsEpic {
    + 史诗：个性化设置与隐私控制
    --
    作为用户
    我希望能够自定义设置并控制隐私
    以便获得更好的使用体验和安全保障
  }
  
  class SettingsStories {
    + 用户故事
    --
    1. 个人资料设置
    2. 隐私设置（最后上线时间、头像可见性）
    3. 通知设置
    4. 聊天设置（壁纸、主题）
    5. 存储管理
    6. 账号安全设置
    7. 数据导出
    8. 账号注销
  }
  
  class SettingsCriteria {
    + 验收标准
    --
    - 设置分类清晰
    - 隐私选项详细
    - 设置实时生效
    - 数据安全可靠
  }
}

SettingsEpic --> SettingsStories
SettingsStories --> SettingsCriteria

' ============================================
' 用户故事优先级
' ============================================

package "优先级划分" #FFF9C4 {
  class Priority {
    + MVP（最小可行产品）
    --
    认证与账号管理
    联系人管理（基础）
    消息通信（文本）
    基本设置
  }
  
  class Priority2 {
    + 第一阶段
    --
    多媒体消息
    音视频通话
    群组功能（基础）
    状态功能
  }
  
  class Priority3 {
    + 第二阶段
    --
    高级搜索
    群组管理
    文件共享优化
    隐私增强
  }
  
  class Priority4 {
    + 未来规划
    --
    企业功能
    第三方集成
    AI 智能助手
    高级分析
  }
}

AuthEpic ..> Priority : 属于
ContactEpic ..> Priority : 属于
MessageEpic ..> Priority : 属于
MessageEpic ..> Priority2 : 部分属于
CallEpic ..> Priority2 : 属于
GroupEpic ..> Priority2 : 属于
StatusEpic ..> Priority2 : 属于
SettingsEpic ..> Priority : 部分属于
SettingsEpic ..> Priority3 : 部分属于

' ============================================
' 用户故事依赖关系
' ============================================

AuthEpic --> ContactEpic : 必须先完成
ContactEpic --> MessageEpic : 必须先完成
MessageEpic --> CallEpic : 可以并行
MessageEpic --> GroupEpic : 可以并行
MessageEpic --> StatusEpic : 可以并行
SettingsEpic --> AuthEpic : 依赖认证

' ============================================
' 验收标准示例
' ============================================

note right of AuthStories
  **用户注册验收标准**
  
  Given: 用户访问注册页面
  When: 填写有效信息并提交
  Then: 
  - 账号创建成功
  - 发送验证邮件
  - 跳转到登录页面
end note

note right of MessageStories
  **发送消息验收标准**
  
  Given: 用户已登录并选择联系人
  When: 输入消息并发送
  Then:
  - 消息立即显示在聊天界面
  - 消息状态显示"已发送"
  - 对方收到消息通知
  - 消息状态更新为"已送达"
end note

note right of CallStories
  **发起通话验收标准**
  
  Given: 用户已登录并选择联系人
  When: 点击语音/视频通话按钮
  Then:
  - 对方收到来电通知
  - 建立 WebRTC 连接
  - 显示通话界面
  - 支持静音、挂断等操作
end note

' ============================================
' 用户故事地图总结
' ============================================

legend right
  |<#E3F2FD> 认证与账号 | MVP 核心功能 |
  |<#BBDEFB> 联系人管理 | MVP 核心功能 |
  |<#90CAF9> 消息通信 | MVP 核心功能 |
  |<#64B5F6> 音视频通话 | 第一阶段 |
  |<#42A5F5> 群组功能 | 第一阶段 |
  |<#1E88E5> 状态功能 | 第一阶段 |
  |<#0D47A1> 设置与隐私 | MVP + 增强 |
  |
  |优先级 | MVP → 第一阶段 → 第二阶段 → 未来 |
endlegend

@enduml

