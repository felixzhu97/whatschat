@startuml Clean Architecture Class Diagram
!theme plain
skinparam classAttributeIconSize 0

title 整洁架构类图示例（登录用例）

' 实体层
package "domain/entities" #LightGreen {
  class User {
    - id: string
    - username: string
    - email: string
    - name?: string
    - avatar?: string
    - isOnline: boolean
    - lastSeen: Date
    - createdAt: Date
    - updatedAt: Date
    --
    + validate(): void
    + updateLastSeen(): User
    + setOnlineStatus(isOnline: boolean): User
  }
  
  class Message {
    - id: string
    - senderId: string
    - content: string
    - timestamp: Date
    - type: MessageType
    - status: MessageStatus
    --
    + markAsRead(): Message
    + edit(newContent: string): Message
  }
}

' 端口（接口）
package "application/ports" #LightBlue {
  interface AuthRepositoryPort {
    + findByEmail(email: string): Promise<User | null>
    + findById(id: string): Promise<User | null>
    + save(user: User): Promise<User>
  }
  
  interface AuthServicePort {
    + verifyPassword(password: string, hash: string): Promise<boolean>
    + generateTokens(user: User): Promise<Tokens>
    + hashPassword(password: string): Promise<string>
  }
}

' 用例层
package "application/use-cases" #LightBlue {
  class LoginUseCase {
    - authRepository: AuthRepositoryPort
    - authService: AuthServicePort
    --
    + execute(dto: LoginDto): Promise<LoginResult>
    - validateInput(dto: LoginDto): void
  }
  
  class RegisterUseCase {
    - authRepository: AuthRepositoryPort
    - authService: AuthServicePort
    --
    + execute(dto: RegisterDto): Promise<User>
    - validateInput(dto: RegisterDto): void
  }
  
  class SendMessageUseCase {
    - messageRepository: MessageRepositoryPort
    - websocketService: WebSocketServicePort
    --
    + execute(dto: SendMessageDto): Promise<Message>
    - validateMessage(dto: SendMessageDto): void
  }
}

' DTO
package "application/dto" #LightBlue {
  class LoginDto {
    + email: string
    + password: string
  }
  
  class RegisterDto {
    + username: string
    + email: string
    + password: string
    + name?: string
  }
  
  class SendMessageDto {
    + contactId: string
    + content: string
    + type: MessageType
  }
}

' 适配器层
package "infrastructure/adapters" #LightYellow {
  class ApiUserRepository {
    - apiClient: ApiClient
    --
    + findByEmail(email: string): Promise<User | null>
    + findById(id: string): Promise<User | null>
    + save(user: User): Promise<User>
  }
  
  class HttpAuthService {
    - apiClient: ApiClient
    --
    + verifyPassword(password: string, hash: string): Promise<boolean>
    + generateTokens(user: User): Promise<Tokens>
    + hashPassword(password: string): Promise<string>
  }
  
  class UserMapper {
    + toDomain(dto: UserDto): User
    + toDto(user: User): UserDto
  }
}

' 框架层
package "infrastructure/framework" #LightYellow {
  class ApiClient {
    - baseURL: string
    - token: string | null
    --
    + get(endpoint: string): Promise<Response>
    + post(endpoint: string, data: any): Promise<Response>
    + setToken(token: string): void
  }
}

' 展示层
package "infrastructure/presentation" #LightYellow {
  class useAuth {
    - loginUseCase: LoginUseCase
    - registerUseCase: RegisterUseCase
    - authStore: AuthStore
    --
    + login(email: string, password: string): Promise<void>
    + register(dto: RegisterDto): Promise<void>
    + logout(): Promise<void>
  }
  
  class AuthStore {
    - user: User | null
    - isAuthenticated: boolean
    - isLoading: boolean
    --
    + setUser(user: User | null): void
    + setLoading(loading: boolean): void
  }
}

' UI 层
package "ui/components" #LightCoral {
  class LoginForm {
    - email: string
    - password: string
    - useAuth: useAuth
    --
    + handleSubmit(): void
    + render(): JSX.Element
  }
}

' 依赖关系
LoginUseCase --> AuthRepositoryPort
LoginUseCase --> AuthServicePort
LoginUseCase --> User
LoginUseCase --> LoginDto

RegisterUseCase --> AuthRepositoryPort
RegisterUseCase --> AuthServicePort
RegisterUseCase --> User
RegisterUseCase --> RegisterDto

SendMessageUseCase --> Message
SendMessageUseCase --> SendMessageDto

ApiUserRepository ..|> AuthRepositoryPort
ApiUserRepository --> User
ApiUserRepository --> ApiClient
ApiUserRepository --> UserMapper

HttpAuthService ..|> AuthServicePort
HttpAuthService --> ApiClient

useAuth --> LoginUseCase
useAuth --> RegisterUseCase
useAuth --> AuthStore

LoginForm --> useAuth

note right of User
  实体类
  包含业务规则
  不依赖任何外部类
end note

note right of LoginUseCase
  用例类
  实现业务逻辑
  依赖端口（接口）
  不依赖具体实现
end note

note right of ApiUserRepository
  适配器实现
  实现端口接口
  处理数据转换
end note

@enduml

