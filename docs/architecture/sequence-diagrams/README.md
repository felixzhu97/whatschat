# WhatsChat 时序图索引

本目录包含了 WhatsChat 项目的关键业务流程时序图，展示了系统各组件之间的交互过程。

## 📋 时序图列表

### 🔐 用户认证流程

- [`user-auth-sequence.puml`](./user-auth-sequence.puml) - 用户注册、登录、令牌刷新流程

### 💬 消息通信流程

- [`message-flow-sequence.puml`](./message-flow-sequence.puml) - 消息发送、接收、编辑、删除流程
- [`web-single-chat-sequence.puml`](./web-single-chat-sequence.puml) - Web端单人聊天完整时序图

### 📞 音视频通话流程

- [`webrtc-call-sequence.puml`](./webrtc-call-sequence.puml) - WebRTC音视频通话建立和管理流程

### 👥 群组管理流程

- [`group-management-sequence.puml`](./group-management-sequence.puml) - 群组创建、加入、权限管理、解散流程

### 📁 文件管理流程

- [`file-upload-sequence.puml`](./file-upload-sequence.puml) - 文件上传、下载、预览、删除流程

### 🚀 系统部署流程

- [`deployment-sequence.puml`](./deployment-sequence.puml) - CI/CD部署、蓝绿部署、回滚、监控告警流程

## 🎯 时序图说明

### 用户认证流程

展示了用户注册、登录和令牌管理的完整流程，包括：

- 用户注册和邮箱验证
- 用户登录和身份验证
- JWT令牌生成和刷新
- 错误处理和用户反馈

### 消息通信流程

展示了实时消息传递的完整流程，包括：

- 消息发送和接收
- 消息状态更新
- 消息编辑和删除
- 文件消息处理
- WebSocket实时通信

### Web端单人聊天流程

展示了Web端单人聊天的完整交互流程，包括：

- 用户认证和初始化
- 聊天列表加载
- WebSocket连接建立
- 联系人选择和聊天开始
- 文本消息发送和接收
- 输入状态指示
- 文件和语音消息处理
- 消息操作（回复、编辑、删除、转发）
- 消息状态更新
- 本地存储同步
- 连接状态管理
- 错误处理和重试机制

### 音视频通话流程

展示了WebRTC音视频通话的完整流程，包括：

- 通话邀请和接受
- WebRTC连接建立
- ICE候选交换
- P2P音视频传输
- 通话结束和清理

### 群组管理流程

展示了群组功能的完整流程，包括：

- 群组创建和成员邀请
- 群组成员管理
- 群组权限控制
- 群组消息广播
- 群组解散流程

### 文件管理流程

展示了文件处理的完整流程，包括：

- 分片文件上传
- 文件权限验证
- 文件下载和预览
- 文件删除和清理
- 文件消息发送

### 系统部署流程

展示了DevOps部署的完整流程，包括：

- CI/CD自动化部署
- 蓝绿部署策略
- 系统回滚机制
- 监控告警处理
- 自动扩容管理

## 🔧 如何查看时序图

### 方法一：在线查看

1. 访问 [Mermaid Live Editor](https://mermaid.live/)
2. 复制时序图内容到编辑器中
3. 实时预览和编辑

### 方法二：VS Code查看

1. 安装 Mermaid Preview 插件
2. 打开 `.puml` 文件
3. 使用预览功能查看时序图

### 方法三：生成图片

1. 使用 Mermaid CLI 工具
2. 将时序图转换为 PNG/SVG 格式
3. 在文档中引用图片

## 📊 时序图统计

### 按类型统计

- **用户流程**: 1个时序图
- **消息流程**: 2个时序图
- **通话流程**: 1个时序图
- **群组流程**: 1个时序图
- **文件流程**: 1个时序图
- **部署流程**: 1个时序图

### 按复杂度统计

- **简单流程** (5-10个步骤): 2个
- **中等流程** (10-20个步骤): 3个
- **复杂流程** (20+个步骤): 2个

### 按参与者统计

- **用户交互**: 7个时序图
- **系统内部**: 7个时序图
- **外部服务**: 5个时序图

## 🔄 时序图维护

### 更新原则

1. **同步性**: 代码变更时同步更新时序图
2. **准确性**: 确保时序图与实际实现一致
3. **完整性**: 覆盖所有关键业务流程
4. **可读性**: 保持时序图清晰易懂

### 更新流程

1. **识别变更**: 代码变更触发时序图更新需求
2. **分析影响**: 确定需要更新的时序图范围
3. **更新内容**: 修改相关时序图内容
4. **验证测试**: 确保时序图逻辑正确
5. **发布通知**: 通知相关人员时序图变更

## 🔗 相关资源

- [Mermaid 官方文档](https://mermaid-js.github.io/mermaid/)
- [时序图语法指南](https://mermaid-js.github.io/mermaid/#/sequenceDiagram)
- [架构图文档](../c4-diagrams/)
- [API文档](../../development/api/api-documentation.md)

## 📞 联系方式

如有时序图相关问题，请联系：

- **邮箱**: z1434866867@gmail.com
- **项目Issues**: [GitHub Issues](https://github.com/your-username/whatschat/issues)
- **技术讨论**: 加入项目讨论群组

## 📄 许可证

本文档采用 [MIT License](../../../LICENSE) 开源许可证。

---
