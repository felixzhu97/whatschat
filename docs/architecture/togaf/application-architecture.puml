@startuml
!theme plain
skinparam componentStyle rectangle
skinparam linetype ortho

title TOGAF Application Architecture - WhatsChat Messaging System

package "Client Applications" {
  component [Web App] as WebApp #LightBlue
  note right of WebApp
    Tech stack:
    - Next.js 15
    - React 19
    - TypeScript
    - Tailwind CSS
    - Zustand state management
  end note
  
  component [Mobile App] as MobileApp #LightGreen
  note right of MobileApp
    Tech stack:
    - React Native
    - Expo
    - TypeScript
    - Zustand state management
  end note
}

package "API Gateway Layer" {
  component [REST API Gateway] as RestGateway
  component [WebSocket Gateway] as WsGateway
  component [WebRTC Signaling] as WebRTCGateway
}

package "Application Services Layer" {
  component [Auth Service] as AuthService
  component [User Service] as UserService
  component [Message Service] as MessageService
  component [Chat Service] as ChatService
  component [Call Service] as CallService
  component [Group Service] as GroupService
  component [Status Service] as StatusService
  component [File Service] as FileService
  component [Notification Service] as NotificationService
}

package "Business Logic Layer" {
  component [Message Handling Logic] as MessageLogic
  component [Realtime Communication Logic] as RealtimeLogic
  component [Authorization Logic] as AuthzLogic
  component [Business Rules Engine] as BusinessRules
}

package "Data Access Layer" {
  component [Data Repository] as DataRepository
  component [Cache Service] as CacheService
}

package "Infrastructure Services" {
  database [PostgreSQL] as PostgreSQL
  database [Redis] as Redis
  component [File Storage] as FileStorage
  component [Search Service] as SearchService
}

/' Client to gateway connections
WebApp --> RestGateway : HTTP/REST
WebApp --> WsGateway : WebSocket
WebApp --> WebRTCGateway : WebRTC signaling
MobileApp --> RestGateway : HTTP/REST
MobileApp --> WsGateway : WebSocket
MobileApp --> WebRTCGateway : WebRTC signaling

/' Gateway to service connections
RestGateway --> AuthService : routes to
RestGateway --> UserService : routes to
RestGateway --> MessageService : routes to
RestGateway --> ChatService : routes to
RestGateway --> CallService : routes to
RestGateway --> GroupService : routes to
RestGateway --> StatusService : routes to
RestGateway --> FileService : routes to

WsGateway --> MessageService : realtime messages
WsGateway --> ChatService : chat events
WsGateway --> NotificationService : push notifications

WebRTCGateway --> CallService : signaling

\' Service to business logic interactions
AuthService --> AuthzLogic : uses
UserService --> AuthzLogic : uses
MessageService --> MessageLogic : uses
ChatService --> MessageLogic : uses
CallService --> RealtimeLogic : uses
GroupService --> BusinessRules : uses
StatusService --> BusinessRules : uses

\' Services to data layer connections
AuthService --> DataRepository : data access
UserService --> DataRepository : data access
MessageService --> DataRepository : data access
ChatService --> DataRepository : data access
CallService --> DataRepository : data access
GroupService --> DataRepository : data access
StatusService --> DataRepository : data access
FileService --> DataRepository : data access
NotificationService --> DataRepository : data access

MessageService --> CacheService : cache access
ChatService --> CacheService : cache access
UserService --> CacheService : cache access

\' Data layer to infrastructure connections
DataRepository --> PostgreSQL : persistent storage
CacheService --> Redis : cache storage
FileService --> FileStorage : file storage
MessageService --> SearchService : full‑text search

rectangle "Application Interaction Patterns" {
  note as N1
    **REST API interactions**
    - User authentication and authorization
    - User profile management
    - Chat list and details
    - Group management
    - File upload & download
    - Status management
  end note
  
  note as N2
    **WebSocket realtime interactions**
    - Realtime message push
    - Online presence sync
    - Typing indicators
    - Message read status
    - System notifications
  end note
  
  note as N3
    **WebRTC P2P interactions**
    - Voice calls
    - Video calls
    - Peer‑to‑peer data transfer
  end note
}

note bottom
  **Application architecture description**
  
  WhatsChat adopts a layered application architecture:
  
  1. **Client applications layer** – Web app (Next.js) and mobile app (React Native/Expo) providing user interfaces
  2. **API gateway layer** – REST API gateway, WebSocket gateway, and WebRTC signaling gateway as unified entrypoints
  3. **Application services layer** – fine‑grained services for auth, users, messages, chats, calls, groups, status, files, and notifications
  4. **Business logic layer** – core business logic and rules processing
  5. **Data access layer** – data repository and cache service abstracting data access
  6. **Infrastructure layer** – PostgreSQL, Redis, file storage, search services, etc.
  
  Applications communicate via REST, WebSocket, and WebRTC to support both synchronous and asynchronous interactions.
  
  **Note**: `FileService` and `NotificationService` are partially implemented via existing message/WebSocket modules today; they can be split into standalone modules in the future.
end note

@enduml
