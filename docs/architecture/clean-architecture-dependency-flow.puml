@startuml Clean Architecture Dependency Flow
!theme plain
skinparam componentStyle rectangle
skinparam linetype ortho

title 整洁架构依赖流向图

rectangle "UI 组件层" as UI {
  component [Login Form] as LoginForm
  component [Message Input] as MessageInput
  component [Chat Area] as ChatArea
}

rectangle "展示层 (Presentation)" as Presentation {
  component [useAuth Hook] as useAuth
  component [useMessages Hook] as useMessages
  component [Auth Store] as AuthStore
  component [Messages Store] as MessagesStore
}

rectangle "适配器层 (Adapters)" as Adapters {
  component [API User Repository] as ApiRepo
  component [HTTP Auth Service] as HttpAuth
  component [User Mapper] as UserMapper
}

rectangle "用例层 (Use Cases)" as UseCases {
  component [Login Use Case] as LoginUC
  component [Send Message Use Case] as SendMsgUC
}

rectangle "实体层 (Entities)" as Entities {
  component [User Entity] as User
  component [Message Entity] as Message
}

' 依赖流向（从外向内）
UI --> Presentation : 使用
Presentation --> Adapters : 调用
Adapters --> UseCases : 实现接口
UseCases --> Entities : 使用

' 具体依赖
LoginForm --> useAuth
useAuth --> AuthStore
useAuth --> LoginUC
LoginUC --> ApiRepo
LoginUC --> HttpAuth
LoginUC --> User
ApiRepo ..> User : 返回
ApiRepo --> UserMapper

MessageInput --> useMessages
useMessages --> MessagesStore
useMessages --> SendMsgUC
SendMsgUC --> Message

' 框架层（最外层）
cloud "框架层" as Framework {
  component [React/Next.js] as React
  component [API Client] as ApiClient
  component [WebSocket] as WebSocket
}

Framework --> UI
Framework --> Adapters
ApiClient --> ApiRepo

note right of Entities
  **最内层**
  
  核心业务对象
  包含业务规则
  不依赖任何外部层
end note

note right of UseCases
  **用例层**
  
  实现业务逻辑
  协调实体和仓储
  定义端口（接口）
  不依赖框架
end note

note right of Adapters
  **适配器层**
  
  实现用例层定义的接口
  处理数据转换和映射
  连接用例和框架
end note

note right of Presentation
  **展示层**
  
  状态管理
  React Hooks
  连接 UI 和用例
end note

note right of UI
  **UI 层**
  
  纯展示组件
  用户交互
  依赖所有内层
end note

note right of Framework
  **框架层**
  
  技术实现
  可以随时替换
  最外层
end note

@enduml

